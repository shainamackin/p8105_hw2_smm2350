---
title: "p8105_hw2_smm2350"
author: "Shaina Mackin" 
date: "2021-10-09"
output: github_document
---

# Homework 2

```{r libraries, echo = FALSE, message = FALSE}
library(tidyverse)
library(readxl)
```

## Problem 1

### First, I will read and clean the Mr. Trash Wheel sheet.

This includes specifying the sheet and omitting non-data entries using `read_excel`, using reasonable variable names, omitting rows without dumpster-specific data, and rounding the number of sports balls to the nearest integer:

```{r trash}
trash_df = 
  read_excel("data files/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", 
  sheet = "Mr. Trash Wheel", 
  range = "A2:N535",
  col_names = TRUE) %>%
janitor::clean_names() %>%
drop_na() %>%
mutate(sports_balls = round(sports_balls), digits = 0)
```

### Second, I will read and clean the precipitation data for 2018 and 2019.

This includes omitting rows without precipitation data and adding a variable for year: 

```{r precipitation_2018_2019}
precip2018_df = 
  read_excel("data files/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
  sheet = "2018 Precipitation",
  skip = 1,
  col_names = TRUE) %>%
janitor::clean_names() %>%
drop_na() %>%
mutate(year = 2018)
  
precip2019_df = 
  read_excel("data files/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
  sheet = "2019 Precipitation",
  skip = 1,
  col_names = TRUE) %>%
janitor::clean_names() %>%
drop_na() %>%
mutate(year = 2019)
```

### Next, I will combine the two precipitation datasets. 

I will also convert month to a character variable: 

```{r precipitation_combined}
precip_df = 
  bind_rows(precip2018_df, precip2019_df) %>%
  janitor::clean_names() %>%
  mutate(month = month.name[as.numeric(month)])
```

### Data description: 

The Mr. Trash Wheel dataset has `r nrow(trash_df)` observations. The median number of sports balls in a dumpster in 2019 was `r trash_df %>% filter(year == 2019) %>% pull(sports_balls) %>% median()` balls. In addition to sports balls, the dataset records number of `cigarette butts`, `glass bottles`, `plastic bottles`, `polystyrene`, `grocery bags`, and `chip bags` every `month` for `r min(pull(trash_df, year))` to `r max(pull(trash_df, year))`. The precipitation dataset has `r nrow(precip_df)` observations, or months. The total precipitation in 2018 was `r precip_df %>% filter(year == 2018) %>% summarise(sum(total))` inches. The precipitation dataset includes the following variables: `r colnames(precip_df)`.

## Problem 2 

### I will clean the `pols` and `snp` datasets.

```{r pols_snp}
pols_df = 
  read_csv("data files/fivethirtyeight_datasets/pols-month.csv") %>%
  janitor::clean_names() %>%
  separate(mon, c("year", "month", "day")) %>%
  mutate(month = month.name[as.numeric(month)]) %>%
  mutate(year = as.numeric(year)) %>%
  mutate(president = factor(prez_dem, labels = c("gop", "dem"))) %>%
  select(-prez_dem, -prez_gop, -day)

snp_df = 
  read_csv("data files/fivethirtyeight_datasets/snp.csv") %>%
  janitor::clean_names() %>%
  mutate(date = lubridate::mdy(date)) %>%
  separate(date, c("year", "month", "date")) %>%
  mutate(month = month.name[as.numeric(month)]) %>%
  mutate(year = as.numeric(year)) %>%
  mutate(year = ifelse(year > 2021, year - 100, year)) %>%
  select(-date)
```

### Next, I will tidy the `unemployment` data. 

This will let me merge it with the previous datasets later: 

```{r unemployment}
unemployment_df = read_csv("data files/fivethirtyeight_datasets/unemployment.csv")

unemployment_tidy_df = 
  read_csv("data files/fivethirtyeight_datasets/unemployment.csv") %>%
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "unemployment") %>%
  mutate(month = match(month, month.abb)) %>%
  mutate(month = month.name[as.numeric(month)]) %>%
  janitor::clean_names() 
```

### Lastly, I will join the datasets.

First, I will merge `snp` and `pols`; then I will merge `unemployment` into the result:

```{r}
snp_pols_df = 
  left_join(pols_df, snp_df, by = c("year", "month"))

snp_pols_unemploy_df = 
  left_join(snp_pols_df, unemployment_tidy_df, by = c("year", "month"))
```

### Data description:

The `pols` dataset contained `r nrow(pols_df)` observations, or dates, ranging from `r min(pull(pols_df, year))` to `r max(pull(pols_df, year))`, with `r ncol(pols_df)` variables all related to the number of `gop` or `dem` politicians in office at that time. The `snp` dataset contained `r nrow(snp_df)` observations, or dates, ranging from `r min(pull(snp_df, year))` to `r max(pull(snp_df, year))`, with the variable `close` referring to the corresponding closing value of the S&P stock index at that time. The `unemployment` dataset originally contained `r nrow(unemployment_df)` observations, or years, with `month` variables and their corresponding percentages of unemployment. The tidied `unemployment` dataset contains `r nrow(unemployment_tidy_df)` observations, or dates, ranging from `r min(pull(unemployment_tidy_df, year))` to `r max(pull(unemployment_tidy_df, year))`, with their corresponding `unemployment` percentages. The joined `snp_pols_unemploy` dataset now contains `r nrow(snp_pols_unemploy_df)` observations, or dates, ranging from `r min(pull(snp_pols_unemploy_df, year))` to `r max(pull(snp_pols_unemploy_df, year))`, with `r ncol(snp_pols_unemploy_df)` variables including `close` value, `unemployment` percentage, and political party (whether `dem` or `rep`) of politicians accordingly. 

## Problem 3

### First, I will load and tidy the baby names data. 

```{r babies}
babies_df = 
  read_csv("data files/Popular_Baby_Names.csv") %>%
  janitor::clean_names() %>%
  mutate(childs_first_name = str_to_lower(childs_first_name)) %>%
  mutate(gender = str_to_lower(gender)) %>%
  mutate(ethnicity = ifelse(grepl("ASIAN AND PACI", ethnicity), "ASIAN AND PACIFIC ISLANDER", 
                            ifelse(grepl("BLACK NON HISP", ethnicity), "BLACK NON HISPANIC",
                                   ifelse(grepl("WHITE NON HISP", ethnicity), "WHITE NON HISPANIC",
                                          "HISPANIC")))) %>%
  mutate(ethnicity = str_to_lower(ethnicity))  %>%
  distinct()
```

### Now, I will make some tables.

```{r olivia_table}

olivia_df = 
  filter(babies_df, childs_first_name == "olivia", gender == "female")

olivia_df %>%
  select(-gender, -childs_first_name, -count) %>%
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "rank"
  ) %>%
knitr::kable(caption = "Rank in popularity of Olivia as a female baby name over time, by ethnicity")
```

```{r malename_table}

male_df = 
  filter(babies_df, gender == "male", rank == 1) 

male_df %>%
  select(-gender, -count, -rank) %>%
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "childs_first_name"
  ) %>%
knitr::kable(caption = "Most popular male baby name over time, by ethnicity")

```

### Lastly, I will make a scatter plot. 

```{r male2016_plot}
male2016_df = 
  filter(babies_df, year_of_birth == 2016, gender == "male", ethnicity == "white non hispanic") %>%
  select(-year_of_birth, -gender, -ethnicity)

male2016_df %>%
  ggplot(aes(x = rank, y = count)) +
  geom_point(size = .5) +
  labs(
    title = "Name counts against name ranks for male, non-hispanic children born in 2016",
    x = "Name rank",
    y = "Name count")
```

  